====================================================================
MyParkingManager v2.3.8 - CHANGELOG
====================================================================

RELEASE DATE: November 8, 2024

====================================================================
NEW FEATURES
====================================================================

1. GUEST PASS GENERATION SYSTEM
   - Create temporary guest vehicle records with 7-day auto-expiration
   - Professional letter-size guest pass printing with property logo
   - Displays vehicle details and expiration date
   - EXPIRED status shown in red for expired guest passes in search

2. TICKET STATUS MANAGEMENT
   - Close parking tickets by marking fines as "collected" or "dismissed"
   - Dedicated Ticket Status screen with status filters (Active/Closed)
   - Property-based filtering for multi-property deployments
   - Comprehensive audit logging of all status changes
   - Database tracks: status, fine_disposition, closed_at, closed_by_user_id

====================================================================
BUG FIXES
====================================================================

1. CRITICAL SECURITY FIX: Ticket Access Control
   - Fixed unauthorized ticket access vulnerability in tickets-list.php
   - Added property membership verification for both vehicle records AND bare tickets
   - WHERE clause now requires: (v.id IS NOT NULL AND v.property IN (...)) OR 
     (v.id IS NULL AND vt.property_name IN (...))

2. PRODUCTION DEPLOYMENT FIX: .htaccess Redirect Loop
   - Fixed infinite redirect loop causing 500 errors on shared hosting
   - Changed routing from index.php to index.html (line 24)
   - Prevents redirect loops on production servers like 2clv.com

3. GUEST PASS FORM: Duplicate Apartment Field
   - Removed duplicate "Apartment / Unit" field from guest pass form
   - Now only asks once for "Visiting Apt/Unit" (where guest is visiting)
   - Cleaner, less confusing user interface

4. TICKET PRINTING: Violation Spacing
   - Removed excessive spacing between violations on printed tickets
   - Violations now print tightly together with minimal gaps
   - Only one single space after the last violation
   - Cleaner, more compact ticket layout

5. TICKET REPRINT: UI Improvements
   - Added "Reprint" button to Ticket Status screen for easy reprinting
   - Made print button more prominent on ticket print page
   - Added clear instructions to prevent accidental ZPL downloads
   - Print button now larger, blue, and clearly labeled for paper printers

6. ZPL PRINTING: Paper Advance (Removed in v11)
   - Initially added 1/2" paper feed for easier ticket tearing
   - Removed per user request (see fix #11)

7. ZPL PRINTING: Larger Headline
   - Increased WARNING/VIOLATION headline size by 50%
   - Font size now 105 (up from 70) for better visibility
   - More prominent ticket type identification

8. GUEST PASS: Auto-Set Tag Number
   - Tag number automatically set to "GUEST" when creating guest passes
   - No need to manually enter tag number for guest vehicles
   - Consistent identification of all guest vehicles

9. VEHICLE EDIT: Fixed Tag Number Validation Error
   - Fixed "tag_number is required" error when editing vehicles
   - Corrected field name mismatch between frontend and backend
   - Changed JavaScript field names from camelCase to snake_case
   - Tag number field now properly populated and validated

10. TICKET PRINTING: Removed Confirmation Popup
   - Removed "Would you like to print it now?" confirmation dialog
   - Print window now opens automatically after ticket creation
   - Smoother, faster workflow for ticket printing

11. ZPL PRINTING: Removed QR Code and Paper Advance
   - Removed QR code from bottom of thermal tickets
   - Removed 1/2" paper advance space (cleaner ticket output)
   - Tickets now end immediately after property contact info

12. ZPL PRINTING: Reduced Vehicle Info Font Size
   - Reduced vehicle information font size by 10% (39 → 35)
   - Reduced tag/plate number font size by 10% (35 → 32)
   - Reduced "following violations..." text by 10% (35 → 32)
   - More compact, cleaner thermal ticket layout

13. iOS SAFARI FIX: CSV Downloads Now Work on iOS
   - Backend: Changed Content-Type from text/csv to application/octet-stream
   - Backend: Added X-Content-Type-Options: nosniff header
   - Frontend: Added iOS Safari detection (isIosSafari() helper function)
   - Frontend: Use direct navigation (window.location.href) on iOS instead of blob downloads
   - Frontend: Keep blob download approach for desktop browsers
   - Vehicle and Violation CSV exports now download correctly on iOS devices

====================================================================
DATABASE CHANGES
====================================================================

New SQL migrations included (backward compatible):

1. add-guest-pass-expiration.sql
   - Adds expiration_date DATE field to vehicles table
   - Includes index for performance
   - Compatible with MySQL 5.7+ and MariaDB 10.2+

2. add-ticket-status.sql
   - Adds status ENUM('active','closed') to violation_tickets
   - Adds fine_disposition ENUM('collected','dismissed')
   - Adds closed_at DATETIME and closed_by_user_id INT
   - Includes foreign key to users table for accountability

====================================================================
DEPLOYMENT PACKAGES
====================================================================

Two packages available:

1. MyParkingManager-v2.3.8-Full.zip (~188 KB)
   - Complete installation package
   - All application files included
   - For new installations or complete replacements

2. MyParkingManager-v2.3.8-Update.zip (~49 KB)
   - Update package with only changed files
   - Includes: .htaccess, index.html, guest-pass-print.html,
     violations-print.html, app-secure.js, 5 API files, 2 SQL migrations
   - For upgrading from v2.3.7

====================================================================
UPGRADE INSTRUCTIONS
====================================================================

FROM v2.3.7 TO v2.3.8:

1. Backup your current installation and database
2. Upload files from Update package (replace existing)
3. Run SQL migrations:
   - sql/add-guest-pass-expiration.sql
   - sql/add-ticket-status.sql
4. Clear browser cache (Ctrl+Shift+R)
5. Test guest pass creation and ticket status features

FRESH INSTALLATION:

1. Extract Full package to your web directory
2. Copy config.example.php to config.php
3. Edit config.php with your database credentials
4. Import sql/schema.sql to create database
5. Run both migration SQL files
6. Access via HTTPS (required for production)
7. Default login: admin / admin123 (change immediately)

====================================================================
SYSTEM REQUIREMENTS
====================================================================

- PHP: 7.4+ (8.3+ recommended)
- MySQL: 5.7+ or MariaDB: 10.2+
- Web Server: Apache with mod_rewrite or Nginx
- HTTPS: Required for production
- PHP Extensions: pdo, pdo_mysql, json, session, mbstring, gd

====================================================================
SECURITY NOTES
====================================================================

- This release includes critical security fixes
- Immediate upgrade recommended for all installations
- HTTPS enforcement recommended for all production deployments
- Change default admin credentials immediately after installation

====================================================================
KNOWN ISSUES
====================================================================

None at this time.

====================================================================
SUPPORT
====================================================================

For issues or questions, refer to the included README.txt or
contact your system administrator.

====================================================================
